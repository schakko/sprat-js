function requireSpratAppInitialized(){if(!sprat.$spratAppInstance)throw"No running sprat.$spratAppInstance. Have you called new sprat.app().initialize() ?";return!0}!function(exports){function jsonParse(str){try{return JSON&&JSON.parse?JSON.parse(str):new Function("return "+str)()}catch(e){te("ijs",e.message)}}function te(ec,context){throw new Error(errorCodes[ec]+(context&&" in '"+context+"'"))}function lex(str,off){off||(off=0);var m=pat.exec(str.substr(off));if(m){off+=m[0].length;var a;return m[1]?a=[off," "]:m[2]?a=[off,m[0]]:m[3]?a=[off,toks.typ,m[0]]:m[4]?a=[off,toks.psc,m[0]]:m[5]?a=[off,toks.psf,m[0]]:m[6]?te("upc",str):m[8]?a=[off,m[7]?toks.ide:toks.str,jsonParse(m[8])]:m[9]?te("ujs",str):m[10]&&(a=[off,toks.ide,m[10].replace(/\\([^\r\n\f0-9a-fA-F])/g,"$1")]),a}}function is(o,t){return typeof o===t}function exprLex(str,off){var v,m=exprPat.exec(str.substr(off));return m?(off+=m[0].length,v=m[1]||m[2]||m[3]||m[5]||m[6],m[1]||m[2]||m[3]?[off,0,jsonParse(v)]:m[4]?[off,0,void 0]:[off,v]):void 0}function exprParse2(str,off){off||(off=0);var lhs,l=exprLex(str,off);if(l&&"("===l[1]){lhs=exprParse2(str,l[0]);var p=exprLex(str,lhs[0]);p&&")"===p[1]||te("epex",str),off=p[0],lhs=["(",lhs[1]]}else!l||l[1]&&"x"!=l[1]?te("ee",str+" - "+(l[1]&&l[1])):(lhs="x"===l[1]?void 0:l[2],off=l[0]);var op=exprLex(str,off);if(!op||")"==op[1])return[off,lhs];"x"!=op[1]&&op[1]||te("bop",str+" - "+(op[1]&&op[1]));var rhs=exprParse2(str,op[0]);off=rhs[0],rhs=rhs[1];var v;if("object"!=typeof rhs||"("===rhs[0]||operators[op[1]][0]<operators[rhs[1]][0])v=[lhs,op[1],rhs];else{for(v=rhs;"object"==typeof rhs[0]&&"("!=rhs[0][0]&&operators[op[1]][0]>=operators[rhs[0][1]][0];)rhs=rhs[0];rhs[0]=[lhs,op[1],rhs[0]]}return[off,v]}function exprParse(str,off){function deparen(v){return"object"!=typeof v||null===v?v:"("===v[0]?deparen(v[1]):[deparen(v[0]),v[1],deparen(v[2])]}var e=exprParse2(str,off?off:0);return[e[0],deparen(e[1])]}function exprEval(expr,x){if(void 0===expr)return x;if(null===expr||"object"!=typeof expr)return expr;var lhs=exprEval(expr[0],x),rhs=exprEval(expr[2],x);return operators[expr[1]][1](lhs,rhs)}function parse(str,off,nested,hints){nested||(hints={});var am,readParen,a=[];for(off||(off=0);;){var s=parse_selector(str,off,hints);if(a.push(s[1]),s=lex(str,off=s[0]),s&&" "===s[1]&&(s=lex(str,off=s[0])),!s)break;if(">"===s[1]||"~"===s[1])"~"===s[1]&&(hints.usesSiblingOp=!0),a.push(s[1]),off=s[0];else if(","===s[1])void 0===am?am=[",",a]:am.push(a),a=[],off=s[0];else if(")"===s[1]){nested||te("ucp",s[1]),readParen=1,off=s[0];break}}nested&&!readParen&&te("mcp",str),am&&am.push(a);var rv;return rv=!nested&&hints.usesSiblingOp?normalize(am?am:a):am?am:a,[off,rv]}function normalizeOne(sel){for(var s,sels=[],i=0;i<sel.length;i++)if("~"===sel[i]){if((2>i||">"!=sel[i-2])&&(s=sel.slice(0,i-1),s=s.concat([{has:[[{pc:":root"},">",sel[i-1]]]},">"]),s=s.concat(sel.slice(i+1)),sels.push(s)),i>1){var at=">"===sel[i-2]?i-3:i-2;s=sel.slice(0,at);var z={};for(var k in sel[at])sel[at].hasOwnProperty(k)&&(z[k]=sel[at][k]);z.has||(z.has=[]),z.has.push([{pc:":root"},">",sel[i-1]]),s=s.concat(z,">",sel.slice(i+1)),sels.push(s)}break}return i==sel.length?sel:sels.length>1?[","].concat(sels):sels[0]}function normalize(sels){if(","===sels[0]){for(var r=[","],i=i;i<sels.length;i++){var s=normalizeOne(s[i]);r=r.concat(","===s[0]?s.slice(1):s)}return r}return normalizeOne(sels)}function parse_selector(str,off,hints){var soff=off,s={},l=lex(str,off);for(l&&" "===l[1]&&(soff=off=l[0],l=lex(str,off)),l&&l[1]===toks.typ?(s.type=l[2],l=lex(str,off=l[0])):l&&"*"===l[1]&&(l=lex(str,off=l[0]));;){if(void 0===l)break;if(l[1]===toks.ide)s.id&&te("nmi",l[1]),s.id=l[2];else if(l[1]===toks.psc)(s.pc||s.pf)&&te("mpc",l[1]),":first-child"===l[2]?(s.pf=":nth-child",s.a=0,s.b=1):":last-child"===l[2]?(s.pf=":nth-last-child",s.a=0,s.b=1):s.pc=l[2];else{if(l[1]!==toks.psf)break;if(":val"===l[2]||":contains"===l[2])s.expr=[void 0,":val"===l[2]?"=":"*=",void 0],l=lex(str,off=l[0]),l&&" "===l[1]&&(l=lex(str,off=l[0])),l&&"("===l[1]||te("pex",str),l=lex(str,off=l[0]),l&&" "===l[1]&&(l=lex(str,off=l[0])),l&&l[1]===toks.str||te("sex",str),s.expr[2]=l[2],l=lex(str,off=l[0]),l&&" "===l[1]&&(l=lex(str,off=l[0])),l&&")"===l[1]||te("epex",str);else if(":has"===l[2]){l=lex(str,off=l[0]),l&&" "===l[1]&&(l=lex(str,off=l[0])),l&&"("===l[1]||te("pex",str);var h=parse(str,l[0],!0);l[0]=h[0],s.has||(s.has=[]),s.has.push(h[1])}else if(":expr"===l[2]){s.expr&&te("mexp",str);var e=exprParse(str,l[0]);l[0]=e[0],s.expr=e[1]}else{(s.pc||s.pf)&&te("mpc",str),s.pf=l[2];var m=nthPat.exec(str.substr(l[0]));m||te("mepf",str),m[5]?(s.a=2,s.b="odd"===m[5]?1:0):m[6]?(s.a=0,s.b=parseInt(m[6],10)):(s.a=parseInt((m[1]?m[1]:"+")+(m[2]?m[2]:"1"),10),s.b=m[3]?parseInt(m[3]+m[4],10):0),l[0]+=m[0].length}}l=lex(str,off=l[0])}return soff===off&&te("se",str),[off,s]}function isArray(o){return Array.isArray?Array.isArray(o):"[object Array]"===toString.call(o)}function mytypeof(o){if(null===o)return"null";var to=typeof o;return"object"===to&&isArray(o)&&(to="array"),to}function mn(node,sel,id,num,tot){var mod,sels=[],cs=">"===sel[0]?sel[1]:sel[0],m=!0;if(cs.type&&(m=m&&cs.type===mytypeof(node)),cs.id&&(m=m&&cs.id===id),m&&cs.pf&&(":nth-last-child"===cs.pf?num=tot-num:num++,0===cs.a?m=cs.b===num:(mod=(num-cs.b)%cs.a,m=!mod&&num*cs.a+cs.b>=0)),m&&cs.has)for(var bail=function(){throw 42},i=0;i<cs.has.length;i++){try{forEach(cs.has[i],node,bail)}catch(e){if(42===e)continue}m=!1;break}return m&&cs.expr&&(m=exprEval(cs.expr,node)),">"!==sel[0]&&":root"!==sel[0].pc&&sels.push(sel),m&&(">"===sel[0]?sel.length>2&&(m=!1,sels.push(sel.slice(2))):sel.length>1&&(m=!1,sels.push(sel.slice(1)))),[m,sels]}function forEach(sel,obj,fun,id,num,tot){var k,x,a=","===sel[0]?sel.slice(1):[sel],a0=[],call=!1,i=0,j=0;for(i=0;i<a.length;i++)for(x=mn(obj,a[i],id,num,tot),x[0]&&(call=!0),j=0;j<x[1].length;j++)a0.push(x[1][j]);if(a0.length&&"object"==typeof obj)if(a0.length>=1&&a0.unshift(","),isArray(obj))for(i=0;i<obj.length;i++)forEach(a0,obj[i],fun,void 0,i,obj.length);else for(k in obj)obj.hasOwnProperty(k)&&forEach(a0,obj[k],fun,k);call&&fun&&fun(obj)}function match(sel,obj){var a=[];return forEach(sel,obj,function(x){a.push(x)}),a}function format(sel,arr){if(sel=sel.replace(/\?/g,function(){if(0===arr.length)throw"too few parameters given";var p=arr.shift();return"string"==typeof p?JSON.stringify(p):p}),arr.length)throw"too many parameters supplied";return sel}function compile(sel,arr){return arr&&(sel=format(sel,arr)),{sel:parse(sel)[1],match:function(obj){return match(this.sel,obj)},forEach:function(obj,fun){return forEach(this.sel,obj,fun)}}}var toString=Object.prototype.toString,errorCodes={bop:"binary operator expected",ee:"expression expected",epex:"closing paren expected ')'",ijs:"invalid json string",mcp:"missing closing paren",mepf:"malformed expression in pseudo-function",mexp:"multiple expressions not allowed",mpc:"multiple pseudo classes (:xxx) not allowed",nmi:"multiple ids not allowed",pex:"opening paren expected '('",se:"selector expected",sex:"string expected",sra:"string required after '.'",uc:"unrecognized char",ucp:"unexpected closing paren",ujs:"unclosed json string",upc:"unrecognized pseudo class"},toks={psc:1,psf:2,typ:3,str:4,ide:5},pat=new RegExp('^(?:([\\r\\n\\t\\ ]+)|([~*,>\\)\\(])|(string|boolean|null|array|object|number)|(:(?:root|first-child|last-child|only-child))|(:(?:nth-child|nth-last-child|has|expr|val|contains))|(:\\w+)|(?:(\\.)?(\\"(?:[^\\\\\\"]|\\\\[^\\"])*\\"))|(\\")|\\.((?:[_a-zA-Z]|[^\\0-\\0177]|\\\\[^\\r\\n\\f0-9a-fA-F])(?:[\\$_a-zA-Z0-9\\-]|[^\\u0000-\\u0177]|(?:\\\\[^\\r\\n\\f0-9a-fA-F]))*))'),nthPat=/^\s*\(\s*(?:([+\-]?)([0-9]*)n\s*(?:([+\-])\s*([0-9]))?|(odd|even)|([+\-]?[0-9]+))\s*\)/,exprPat=new RegExp('^\\s*(?:(true|false|null)|(-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?)|("(?:[^\\]|\\[^"])*")|(x)|(&&|\\|\\||[\\$\\^<>!\\*]=|[=+\\-*/%<>])|([\\(\\)]))'),operators={"*":[9,function(lhs,rhs){return lhs*rhs}],"/":[9,function(lhs,rhs){return lhs/rhs}],"%":[9,function(lhs,rhs){return lhs%rhs}],"+":[7,function(lhs,rhs){return lhs+rhs}],"-":[7,function(lhs,rhs){return lhs-rhs}],"<=":[5,function(lhs,rhs){return is(lhs,"number")&&is(rhs,"number")&&rhs>=lhs||is(lhs,"string")&&is(rhs,"string")&&rhs>=lhs}],">=":[5,function(lhs,rhs){return is(lhs,"number")&&is(rhs,"number")&&lhs>=rhs||is(lhs,"string")&&is(rhs,"string")&&lhs>=rhs}],"$=":[5,function(lhs,rhs){return is(lhs,"string")&&is(rhs,"string")&&lhs.lastIndexOf(rhs)===lhs.length-rhs.length}],"^=":[5,function(lhs,rhs){return is(lhs,"string")&&is(rhs,"string")&&0===lhs.indexOf(rhs)}],"*=":[5,function(lhs,rhs){return is(lhs,"string")&&is(rhs,"string")&&-1!==lhs.indexOf(rhs)}],">":[5,function(lhs,rhs){return is(lhs,"number")&&is(rhs,"number")&&lhs>rhs||is(lhs,"string")&&is(rhs,"string")&&lhs>rhs}],"<":[5,function(lhs,rhs){return is(lhs,"number")&&is(rhs,"number")&&rhs>lhs||is(lhs,"string")&&is(rhs,"string")&&rhs>lhs}],"=":[3,function(lhs,rhs){return lhs===rhs}],"!=":[3,function(lhs,rhs){return lhs!==rhs}],"&&":[2,function(lhs,rhs){return lhs&&rhs}],"||":[1,function(lhs,rhs){return lhs||rhs}]};exports._lex=lex,exports._parse=parse,exports.match=function(sel,arr,obj){return obj||(obj=arr,arr=void 0),compile(sel,arr).match(obj)},exports.forEach=function(sel,arr,obj,fun){return fun||(fun=obj,obj=arr,arr=void 0),compile(sel,arr).forEach(obj,fun)},exports.compile=compile}("undefined"==typeof exports?window.JSONSelect={}:exports);var sprat=sprat||{};sprat.$spratAppInstance=sprat.$spratAppInstance||null,sprat.app=function(config){var self=this;!function(config){if(!config)throw"You must provide a configuration object for your Sprat application";if(!config.flavor)throw"You must provide a 'flavor' attribute for your application configuration";if($.inArray(config.flavor,["spring","laravel"])<0)throw"Only 'spring' or 'laravel' allowed as flavor";if(config.configure){if(!jQuery.isFunction(config.configure))throw"Attribute 'configure' must be a callback function";self.configure=config.configure}self.config=config,sprat.$spratAppInstance=self}(config),self.configure=function(){},self.initialize=function(){config.configure&&config.configure()},self.run=function(callback){$(document).ready(callback)},self.flavor=function(){return self.config.flavor},self.debug=function(){return self.config.debug}};var sprat=sprat||{},$=$||{};sprat.path=function(){var self={},mappings={resource:{},collection:{}},accessors={resource:null,collection:null},util={createFluentInterface:function(mapping,aliasFunctions){var _self={};return _self.mapping=mapping,_self.aliasFunctions=aliasFunctions,_self.add=function(alias){if(0===arguments.length)throw"Expected at least an alias when adding a resource or a collection";alias=arguments[0];var append="",_templatePathTranslator=null;if(arguments.length>1&&("string"==typeof arguments[1]?append=arguments[1]:"function"==typeof arguments[1]&&(_templatePathTranslator=arguments[1])),append&&/^\w/.test(append)&&(append="/"+append),_templatePathTranslator=_templatePathTranslator||function(state){return sprat.web.uri.parse(state.root+append,state.lastArguments)},_self.aliasFunctions[alias])throw"Alias '"+alias+"' is already defined";return _self.mapping[alias]={uri:_templatePathTranslator,renderer:function(){throw"Renderer not defined"},context:{}},_self.aliasFunctions[alias]=function(){return util.pushArguments(this.__internal.lastArguments,arguments),_self.mapping[alias].uri(this.__internal)},_self},_self.finish=function(){return self},_self},initializeAccessor:function(aliasFunctions){var _self={};return _self.aliasFunctions=aliasFunctions,function(){return _self.aliasFunctions.__internal.lastArguments=this,_self.aliasFunctions}},createAliasFunctionHolder:function(root){var aliasFunctions={__internal:{root:root,lastArguments:[]}};return aliasFunctions},pushArguments:function(array,args){for(var i=0;i<args.length;i++){var value=self.resolvers.resolve(args[i]);array.push(value)}return array}};return self._mapppings=function(){return mappings},self.resolvers={registered:[function(data){if(data&&data._links&&data._links.self){var s=data._links.self.href,id=s.substring(s.lastIndexOf("/")+1);return id.indexOf("{")>0?id.substring(0,id.indexOf("{")):id}},function(data){return data}],resolve:function(data){for(var i=0;i<this.registered.length;i++){var r=this.registered[i](data);if(void 0!==r)return r}return data}},self.resource=function(){if(!accessors.resource)throw"No resource path has been prior defined by using resourceAt(...)";return accessors.resource.apply(util.pushArguments([],arguments))},self.resourceAt=function(root){var aliasFunctions=util.createAliasFunctionHolder(root);return accessors.resource=new util.initializeAccessor(aliasFunctions),new util.createFluentInterface(mappings.resource,aliasFunctions)},self.collection=function(){if(!accessors.collection)throw"No collection path has been prior defined by using collectionAt(...)";return accessors.collection.apply(util.pushArguments([],arguments))},self.collectionAt=function(root){var aliasFunctions=util.createAliasFunctionHolder(root);return accessors.collection=new util.initializeAccessor(aliasFunctions),new util.createFluentInterface(mappings.collection,aliasFunctions)},self};var sprat=sprat||{};sprat.security={csrf:{configure:function(){requireSpratAppInitialized()||function(){throw"sprat/app.js not included?"}();switch(sprat.$spratAppInstance.flavor()){case"laravel":sprat.security.csrf.configureLaravel();break;default:sprat.security.csrf.configureSpringSecurity()}},configureSpringSecurity:function(){var token=$("meta[name='_csrf']").attr("content"),header=$("meta[name='_csrf_header']").attr("content");if(!token||!header)throw"You must define <meta name='_csrf' /> and <meta name='_csrf_header' />, see http://stackoverflow.com/questions/23477344/put-csrf-into-headers-in-spring-4-0-3-spring-security-3-2-3-thymeleaf-2-1-2";$(document).ajaxSend(function(e,xhr,options){xhr.setRequestHeader(header,token)})},configureLaravel:function(){var token=$("meta[name='_csrf']").attr("content");if(!token)throw"You must define <meta name='_csrf' />, see http://laravel.com/docs/5.1/routing#csrf-x-csrf-token";$(document).ajaxSend(function(e,xhr,options){xhr.setRequestHeader("X-CSRF-TOKEN",token)})}}};var sprat=sprat||{};sprat.uri=sprat.uri||{},sprat.uri.actionMapper=function(_root,_defaults){var self=this;self.root=_root,self.register=function(name,data){self.registered[name]=data},self.arguments=[],self.registered={},self.data=function(alias){if(!alias)return"";var obj=self.registered[alias];if(void 0===obj)throw"There is no URI mapping for alias '"+alias+"'";return obj},self.uri=function(alias){obj=self.data(alias),"object"==typeof obj&&(obj.uri||(obj=""));var args=$.merge([self.root],self.arguments);if("function"==typeof obj)return obj.apply($.merge(args,[alias]));if(0===obj.indexOf("/"))return obj;var joined=$.grep(args,function(elem){return null!==elem}).join("/");return joined+"/"+obj};for(var alias in _defaults)self.register(alias,_defaults[alias]);return self},sprat.uri.resourceModel=function(_baseUrl,_defaults){var self=this,root=_baseUrl,defaults={collections:{list:""},resources:{detail:""}};$.extend(!0,defaults,_defaults),self.collections=new sprat.uri.actionMapper(root,defaults.collections),self.resources=new sprat.uri.actionMapper(root,defaults.resources),self.collection=function(){return self.collections},self.resource=function(data){var resolvedId=self.resourceIdResolver(data);if(void 0!==resolvedId)return self.resources.arguments=[resolvedId],self.resources},self.resourceIdResolver=function(data){if(void 0===data||0===data)return null;if(data%1===0)return data;if(data&&data._links&&data._links.self){var s=data._links.self.href,id=s.substring(s.lastIndexOf("/")+1);return id.indexOf("{")>0?id.substring(0,id.indexOf("{")):id}throw"The provided resource resource is not an integer value nor does it contain the path _links.self with the root of the resource. Override .resource.rest.root"}},sprat.uri.resourceModel.defaults=function(_baseUrl,_defaults){var defaults={resources:{detail:{title:"Details",icon:"share"},edit:{title:"Bearbeiten",icon:"pencil"}}};return new sprat.uri.resourceModel(_baseUrl,$.extend(!0,{},defaults,_defaults))},sprat.uri.requestParameter=function(parameter,search){var a=(search||window.location.search).substr(1).split("&");if(""===a)return{};for(var b={},i=0;i<a.length;++i){var p=a[i].split("=");2==p.length&&(b[p[0]]=decodeURIComponent(p[1].replace(/\+/g," ")))}return b&&b[parameter]?b[parameter]:b};var sprat=sprat||{};sprat.util=sprat.util||{isFunction:function(check){var getType={};return check&&"[object Function]"===getType.toString.call(check)},lookup:function(elements,id,successCallback){var r,check=id;$util.isFunction(check)||(check=function(element){return element.id==id});for(var idx in elements){var element=elements[idx];if(r=element,check(element)&&(successCallback&&(r=successCallback(element,idx)),void 0!==r))break}return r}},sprat.util.array=sprat.util.array||{search:function(array,propertyValuesToSearch,property){var item,key,value,candidates={},r=[],i=0,m=0;for(property=property||"id",i=0,m=propertyValuesToSearch.length;m>i;i++)key=propertyValuesToSearch[i],candidates[key]=key;for(i=0,m=array.length;m>i;i++)item=array[i],value=item[property],candidates[value]&&r.push(item);return r},removeById:function(array,id){var idx=sprat.util.lookup(array,id,function(elem,idx){return idx});return sprat.util.array.removeByIndex(array,idx)},removeByIndex:function(array,idx){if(0>idx)return-1;if(idx>array.length-1)throw"Invalid array index position";return array.splice(idx,1),idx},update:function(array,element,idx){void 0===idx&&(idx=sprat.util.lookup(array,element.id,function(elem,idx){return idx})),void 0!==idx?array[idx]=element:sprat.util.array.add(array,element)},add:function(array,element,idx){return void 0===idx?(array.push(element),array.length-1):(array.splice(idx,0,element),idx)}};var $util=sprat.util,$array=sprat.util.array,sprat=sprat||{},$=$||{};sprat.web={uri:{parse:function(path,parameters){function valueFor(prefix,identifier,_defaultValue,parameters){if(parameters=parameters||{},$.isNumeric(identifier)&&parseInt(identifier)<parameters.length)return prefix+parameters[parseInt(identifier)];for(var i=0;i<parameters.length;i++)if("object"==typeof parameters[i]){if(parameters[i][identifier])return prefix+parameters[i][identifier]}else if(parameters[i]==identifier)return prefix+identifier;for(var key in parameters)if(key==identifier)return prefix+parameters[key];return _defaultValue||""}for(var matches,matcher=/\{([\?|\&]?)(\w*)(:(\w*))?\}/;null!==(matches=matcher.exec(path));){var replace=matches[0];path=path.replace(replace,valueFor(matches[1],matches[2],matches[4],parameters))}return path}},hateoas:{relation:function(object,name,parameters){var links=null,href=null,rel=null;if(!object||!object.links&&!object._links)throw"Invalid HATEOAS object without .links";links=object._links||object.links;for(var idx in links){if("string"==typeof links[idx])rel=idx,href=links[idx];else if("object"==typeof links[idx]){var current=links[idx];current.rel?(rel=current.rel,href=current.href):current[name]&&current[name].href?(rel=name,href=current[name].href):idx==name&&current.href&&(rel=idx,href=current.href)}if(rel==name)break;href=void 0}if(!href)throw"HATEOAS relation with name '"+name+"' does not exist";return sprat.web.uri.parse(href,parameters)},embedded:function(data){if(data._embedded){var key=null;for(key in data._embedded)return data._embedded[key]}return[]}}},$hateoas=sprat.web.hateoas;var sprat=sprat||{},$rest=$rest||{};sprat.wrestle=function(){var self={};self.hateoas={isSelfHrefAvailable:function(data){return this.isValidResourceLink("self",data)},isValidResourceLink:function(resourceName,data){return data&&data._links&&data._links[resourceName]&&data._links[resourceName].href},resourceLink:function(resourceName,data){if(!this.isValidResourceLink(resourceName,data))throw"Resource link '"+resourceName+"' does not exist";return data._links[resourceName].href}};var util={isJqXHR:function(object){return object&&object.status&&object.readyState&&void 0!==object.responseText},runPipes:function(pipe,data,jqXHR,textStatus,context){for(var i=0,m=pipe.length;m>i;i++){var handler=pipe[i];if("function"!=typeof handler)throw util.error("Expected a function but got the following element:"),util.debug(handler),"Expected a function as pipe handler, current element at index '"+i+"' is "+handler;var r=handler(data,jqXHR,textStatus,context);if(r===!0)return void util.debug("Pipe returned true, no further pipe handling")}},debug:function(msg){console&&sprat.$spratAppInstance&&sprat.$spratAppInstance.debug()&&console.debug(msg)},error:function(msg){console&&console.error(msg)},info:function(msg){console&&console.info(msg)},assertArray:function(param){return null===param||void 0===param?[]:$.isArray(param)?param:[param]}};return self.pipes={always:{successForHttpHeaderBetween200And399:function(){return function(dataOrJqXHR,textStatus,jqXHROrErrorThrown,context){util.debug("Running successForHttpHeaderBetween200And399 ... ");var jqXHR=util.isJqXHR(dataOrJqXHR)?dataOrJqXHR:jqXHROrErrorThrown;if(jqXHR.status>=200&&jqXHR.status<400){util.debug("Received HTTP status code >= 200 && < 400, executing success pipe");var data=dataOrJqXHR;return"parseerror"==textStatus&&(data=jQuery.parseJSON(jqXHR.responseText)),util.runPipes(context.pipes.success,data,jqXHR,textStatus,context),!0}return util.debug("Status code '"+jqXHR.status+"' is *not* handled by pipes.success"),!1}},fallbackToFail:function(){return function(dataOrJqXHR,textStatus,jqXHROrErrorThrown,context){util.debug("Running fallbackToFail ... ");var jqXHR=util.isJqXHR(dataOrJqXHR)?dataOrJqXHR:jqXHROrErrorThrown,data={};if(jqXHR.responseText)try{data=jQuery.parseJSON(jqXHR.responseText)}catch(ex){util.debug("Failed to parse responseText as JSON, content '"+jqXHR.responseText+"'")}util.debug("Running "+context.pipes.fail.length+" error handlers"),util.runPipes(context.pipes.fail,data,jqXHR,textStatus,context)}}},success:{handleRedirect:function(){return function(data,jqXHR){util.debug("Running handleRedirect ...");var location=jqXHR.getResponseHeader("Location")||jqXHR.getResponseHeader("X-Sprat-Next-Location");return location?(window.location.replace(location),!0):void 0}},handleModelUpdated:function(){return function(data,jqXHR,textStatus,context){return util.debug("Running handleModelUpdated"),"204"==jqXHR.status?(util.debug("Received HTTP 204 response, triggering handleModelUpdated event"),$(document).trigger("handleModelUpdated",[data,jqXHR,context]),!0):void 0}},expectResponseCode:function(){return function(data,jqXHR,textStatus,context){return util.debug("Running expectResponseCode"),context.expectResponseCode?jqXHR.status==context.expectResponseCode?(util.debug("Received expected HTTP response code '"+context.expectResponseCode+"', triggering expectResponseCode event"),$(document).trigger("expectResponseCode",[data,jqXHR,context]),!0):void 0:(util.debug("no .expectResponseCode given in .context, returning"),!1)}},handleUserNextAction:function(){return function(){}}},fail:{springApplicationExceptionHandler:function(){return function(data,jqXHR,textStatus,errorThrown,context){var hasException=data.cause||data.exception&&"org.springframework.validation.BindException"!=data.exception;if(hasException){util.debug("Triggering springApplicationExceptionHandler");var exception="object"==typeof data?data:jQuery.parseJSON(data.responseText);return $(document).trigger("springApplicationExceptionHandler",[exception,context,data,jqXHR,textStatus,errorThrown]),!0}}},springRESTErrors:function(){return function(data,jqXHR,textStatus,context){var parsedData={};try{parsedData=jQuery.parseJSON(jqXHR.responseText)}catch(ex){}var errors=null;return parsedData.error?(util.debug("Triggering springRESTErrors ... "),errors=[parsedData],$(document).trigger("springRESTErrors",[errors,context,data,jqXHR,textStatus]),!0):void 0}},springValidationErrors:function(){return function(data,jqXHR,textStatus,context){var parsedData={};try{parsedData=jQuery.parseJSON(jqXHR.responseText)}catch(ex){}var errors=null;return parsedData.errors&&$.isArray(parsedData.errors)?(util.debug("Triggering springValidationErrors ... "),errors=parsedData.errors,$(document).trigger("springValidationErrors",[errors,context,data,jqXHR,textStatus]),!0):void 0}},unknownResponse:function(){return function(data,jqXHR,textStatus,context){var error="Received unrecognized response from the backend, please contact developers";throw console&&(util.debug("Data of unrecognized response: "),util.debug(data),util.debug(context)),error}}}},self.configuration={firstResponseHandlers:function(){return[new self.pipes.always.successForHttpHeaderBetween200And399,new self.pipes.always.fallbackToFail]},profiles:{add:function(name,config){config=$.extend(!0,{success:[],fail:[]},config),self.configuration.profiles[name]=config}},handlers:{},defaults:{success:function(){return[new self.pipes.success.handleRedirect,new self.pipes.success.handleModelUpdated,new self.pipes.success.expectResponseCode,new self.pipes.success.handleUserNextAction]},fail:function(){return[new self.pipes.fail.springApplicationExceptionHandler,new self.pipes.fail.springRESTErrors,new self.pipes.fail.springValidationErrors]}}},self._delegateSimpleRequest=function(_arguments,method){var context={pipes:{success:void 0,fail:void 0},handlers:self.configuration.handlers,ajax:{}},data=null,providedSuccessCallbacks=null,providedFailCallbacks=null,idxBeginCallbacks=1,idxEndCallbacks=3;if("string"==typeof _arguments)throw"_arguments must be an array";if(0===_arguments.length||_arguments>4)throw"_toCallArguments must have [url], [url, cbSuccess()], [url, data, cbSuccess()], [url, data, options] or [url, data, cbSuccess(), options] as first argument. You gave: "+JSON.stringify(_arguments);if(_arguments.length>2){var lastArgument=_arguments[_arguments.length-1];"object"!=typeof lastArgument||jQuery.isArray(lastArgument)||(context=$.extend(!0,context,lastArgument),idxEndCallbacks=_arguments.length-2)}return _arguments.length>=2&&"object"==typeof _arguments[1]&&(data=_arguments[1],idxBeginCallbacks=2),idxBeginCallbacks<=_arguments.length-1&&(idxEndCallbacks>=idxBeginCallbacks&&(providedSuccessCallbacks=_arguments[idxBeginCallbacks]),idxBeginCallbacks+1==idxEndCallbacks&&(providedFailCallbacks=_arguments[idxEndCallbacks])),context=self.updatePipes(providedSuccessCallbacks,providedFailCallbacks,context),self.call(_arguments[0],data,method,context)},self.updatePipes=function(success,fail,context){if(context=$.extend(!0,{pipes:{success:void 0,fail:void 0},handlers:{}},context),context.profile){if(util.debug("Profile '"+context.profile+"' activated"),!self.configuration.profiles[context.profile])throw"Requested profile '"+context.profile+"' does not exist";context.pipes=self.configuration.profiles[context.profile]}return success&&(context.pipes=context.pipes||{},context.pipes.success=util.assertArray(success),fail&&(context.pipes.fail=util.assertArray(fail))),void 0===context.pipes.success&&(context.pipes.success=self.configuration.defaults.success()),void 0===context.pipes.fail&&(context.pipes.fail=self.configuration.defaults.fail()),context},self.call=function(_url,_data,_method,_context){var self_call={};if(!_method)throw"HTTP method not provided";var contextDefault={method:_method,firstResponseHandlers:self.configuration.firstResponseHandlers(),ajax:{url:_url,type:_method,dataType:"text json",contentType:"application/json"}};return self_call.context=$.extend(!0,contextDefault,_context),_data&&(self_call.context.ajax.data||("GET"==_method?self_call.context.ajax.data=_data:self_call.context.ajax.data=JSON.stringify(_data))),$.ajax(self_call.context.ajax).always(function(a,b,c){self.run(self_call.context.firstResponseHandlers,a,b,c,self_call.context)})},self.run=function(pipes,data,jqXHR,textStatus,context){util.runPipes(pipes,data,jqXHR,textStatus,context)},self}(),$rest.get=function(){return sprat.wrestle._delegateSimpleRequest(arguments,"GET")},$rest.post=function(){return sprat.wrestle._delegateSimpleRequest(arguments,"POST")},$rest.save=function(_url,_object,_context){_context=_context||{},_context.isPersisted=$rest.isPersisted(_object),_context.ajax=_context.ajax||{};var method=_context.isPersisted?"PATCH":"POST";return sprat.wrestle._delegateSimpleRequest([_url,_object,_context],method)},$rest.associationSave=function(_url,_references,_context){$.isArray(_references)||(_references=[_references]);var context={ajax:{contentType:"text/uri-list",data:_references.join("\r\n")}},useContext=$.extend(!0,_context,context);return sprat.wrestle._delegateSimpleRequest([_url,null,useContext],"PUT")},$rest.hateoasUpdate=function(_object,_assocs,_callback,_context){if(!sprat.wrestle.hateoas.isSelfHrefAvailable(_object))throw"Missing _links.self.href section";var resourceAssocs={};for(var resourceName in _assocs)resourceAssocs[sprat.wrestle.hateoas.resourceLink(resourceName,_object)]=_assocs[resourceName];_context=_context||{},_context.pipes||(_context.pipes=[]),_context.pipes.success||(_context.pipes.success=[]);var arrMethods=[];arrMethods.push($rest.save(sprat.wrestle.hateoas.resourceLink("self",_object),_object,_context));for(var resourceLink in resourceAssocs)arrMethods.push($rest.associationSave(resourceLink,resourceAssocs[resourceLink],_context));$.when.apply($,arrMethods).then(_callback)},$rest.isPersisted=function(_object){if(!_object)throw"no object given";return _object._links&&_object._links.self.href?!0:_object.id&&_object.id>0};var sprat=sprat||{};sprat.ui=sprat.ui||{},Object.byString=function(o,s){s=s.replace(/\[(\w+)\]/g,".$1"),s=s.replace(/^\./,"");for(var a=s.split(".");a.length;){var n=a.shift();if(!(n in o))return;o=o[n]}return o},sprat.ui.modal=function(_options){var defaults={title:"Kein Titel",body:"Kein Text",footer:'<button type="button" class="btn btn-default" data-dismiss="modal">Schlie√üen</button>',closeable:!0,root:"#modal"},options=$.extend(!0,defaults,_options),modal=$(options.root);modal.find(".modal-body").html(options.body),modal.find(".modal-title").html(options.title);var args="show";options.closeable?modal.find(".modal-footer").html(options.footer):(modal.find(".modal-header .close").hide(),modal.find(".modal-footer").hide(),args={keyboard:!1}),$(options.root).modal(args)};var sprat=sprat||{};sprat.ui=sprat.ui||{},sprat.ui.datetime={options:{cssInputSelector:".datepicker",cssOutputSelector:".dateformat",customFormatAttribute:"date-format",cssSuffix:"",backendIsInUTC:!0,backingFieldAttribute:"backing-field",formats:[{backendFormat:"DD.MM.YYYY",frontendFormat:"DD.MM.YYYY",datetimepicker:{calendarWeeks:!0}},{cssSuffix:"-with-time",backendFormat:"DD.MM.YYYY HH:mm",frontendFormat:"DD.MM.YYYY HH:mm"},{cssSuffix:"-full-time",backendFormat:"DD.MM.YY HH:ss",frontendFormat:"DD.MM.YYYY HH:ss"}],datetimepicker:{calendarWeeks:!0}},toFormat:function(input,formatInput,formatOutput,isInputUtc){var functionConvert=isInputUtc?moment.utc:moment,parsed=functionConvert(input,formatInput),target=isInputUtc?parsed.toDate():parsed,result=moment(target).format(formatOutput);return result},init:function(_options){var options=$.extend(!0,sprat.ui.datetime.options,_options||{});$.each(options.formats,function(idx,entry){var localOptions=$.extend(!0,{},options,entry),inputSelector=localOptions.cssInputSelector+localOptions.cssSuffix,outputSelector=localOptions.cssOutputSelector+localOptions.cssSuffix,useUTC=localOptions.backendIsInUTC;useUTC&&$(inputSelector).each(function(){var utcDateTimeBackend=$(this).val(),result=sprat.ui.datetime.toFormat(utcDateTimeBackend,localOptions.backendFormat,localOptions.frontendFormat,useUTC);$(this).val(result)}),localOptions.datetimepicker.format=localOptions.frontendFormat,$(inputSelector).datetimepicker(localOptions.datetimepicker),$(outputSelector).each(function(){var customOutputFormat=$(this).attr(localOptions.customFormatAttribute),useOuputFormat=customOutputFormat||localOptions.frontendFormat,result=sprat.ui.datetime.toFormat($(this).text(),localOptions.backendFormat,useOuputFormat,localOptions.backendIsInUTC);
$(this).text(result)}),$(inputSelector).each(function(){var backingField=$("input[name='"+$(this).attr(localOptions.backingFieldAttribute)+"']");backingField&&$(this).on("dp.change",function(e){var result=moment(e.date).format(localOptions.backendFormat);useUTC&&(result=moment.utc(e.date).format(localOptions.backendFormat)),backingField.val(result)})})})}};var sprat=sprat||{};sprat.ui=sprat.ui||{},sprat.ui.navigation=sprat.ui.navigation||{},sprat.ui.navigation.actions={create:function(actions){if(!jQuery.isArray(actions))throw"Argument is not an array";jQuery.each(actions,function(idx,item){if(!item.title||!item.url)throw"You must provide an .title and an .url attribute for the action "+item});var result=function(actions){var self=this;self.actions=actions,self.toString=function(_restrictActions){var r="",idx=null,restrictActions={_isRestricted:!1};if(jQuery.isArray(_restrictActions)){restrictActions._isRestricted=!0;for(idx in _restrictActions){var restrictedAction=_restrictActions[idx];restrictActions[restrictedAction]=restrictedAction}}for(idx in self.actions){var action=self.actions[idx],icon="";(!restrictActions._isRestricted||action.alias&&restrictActions[action.alias])&&(action.icon&&(icon="<i class='fa fa-"+action.icon+"'></i> "),r+="<a href='"+action.url+"'><button class='btn btn-default'>"+icon+action.title+"</button></a>")}return r}};return new result(actions)}},sprat.ui.navigation.menu={_defaultVisitor:function(liSelector,listOfVisitedLeafs){var ul=$(liSelector).closest("ul"),liSelectorParentItem=$(liSelector).attr("navigation-parent-item")||$(ul).attr("navigation-parent-item");return $(ul).find("li").removeClass("active"),$(liSelector).find("button").toggleClass("btn-primary").toggleClass("btn-default"),listOfVisitedLeafs.push($(liSelector)),liSelectorParentItem?liSelectorParentItem:null},_defaultPostProcessor:function(visitedLeafs){for(var i=visitedLeafs.length-1;i>=0;i--)visitedLeafs[i].addClass("active")},traverse:function(leaf,_callbackVisitor,_callbackPostProcessor,_visitedLeafs){var visit=_callbackVisitor,postProcess=_callbackPostProcessor;visit||(visit=sprat.ui.navigation.menu._defaultVisitor),postProcess||(postProcess=sprat.ui.navigation.menu._defaultPostProcessor),_visitedLeafs||(_visitedLeafs=[]);var parent=visit(leaf,_visitedLeafs);parent?sprat.ui.navigation.menu.traverse(parent,visit,postProcess,_visitedLeafs):postProcess(_visitedLeafs)}};var sprat=sprat||{};sprat.ui=sprat.ui||{},sprat.ui.renderer=function(){var self=this;return self.get=function(rendererName){var initializerArguments=arguments.length>1?Array.prototype.slice.call(arguments,1):[],dispatcher=function(){var fullDispatchedArguments=$.merge([],$.merge(Array.prototype.slice.call(arguments),initializerArguments)),renderer=self.renderers["default"],r="";if(self.renderers[rendererName])renderer=self.renderers[rendererName];else{var matched=Object.byString(self.renderers,rendererName);void 0!==matched&&(renderer=matched)}if(!renderer)throw"Renderer '"+rendererName+"' has not been registered. Use sprat.ui.renderer.register($name, $callback) to register a renderer.";if("function"==typeof renderer)r+=renderer.apply(void 0,fullDispatchedArguments);else{if("object"!=typeof renderer||!renderer.ui)throw"The renderer '"+rendererName+"' is neither a function nor an object containing a method named 'ui'";if("function"!=typeof renderer.ui)throw"The renderer '"+rendererName+"' is of type object and has the property 'ui' but 'ui' is not a method";r+=renderer.ui.apply(void 0,fullDispatchedArguments)}return r};return dispatcher},self.render=function(rendererName){var renderer=self.get(rendererName);return renderer.apply(args)},self.register=function(name,renderer){return this.renderers[name]=renderer,this},self.renderers={},self}();var sprat=sprat||{};sprat.ui=sprat.ui||{},sprat.ui.validation=sprat.ui.validation||{},sprat.ui.validation.errorDecorator={defaultOptions:{form:{selector:"form:first",$instance:null,resolveInput:function(_field,$form){var $input=$form.find(":input[name='"+_field+"']");return 0===$input.length&&($input=$form.find("#"+_field)),0===$input.length?null:$input}},errors:{displaySummary:function(_content,$form,_options){$form.prepend(_content)},transform:function(_errors){return _errors},formatSummary:function(_errors,_unmappedErrors,_errorDecorator){var msg="Es sind "+_errors.length+" Validierungsfehler aufgetreten.",error=null;if(_unmappedErrors.length>0){for(msg+="<ul>",i=0,m=_unmappedErrors.length;i<m;i++)error=_unmappedErrors[i],msg+="<li>"+error.field+": "+error.message+"</li>";msg+="</ul>",_unmappedErrors.length<_errors.length&&(msg+="Alle weiteren Fehler wurden an den jeweiligen Eingabefeldern markiert.")}return msg},formatInputError:function(_field,_message,_errorDecorator){return"<div class='"+_errorDecorator.options.cssHasError+" "+_errorDecorator.options.cssErrorText+"'><label class='control-label'>"+_message+"</label></div>"}},exception:{formatException:function(_exception,_errorDecorator){return"<div class='"+_errorDecorator.options.cssErrorText+" alert alert-danger'>Es sind Fehler in der Anwendung aufgetreten: "+_exception.message+"</div>"}},cssErrorContainer:"error-container",cssHasError:"has-error",cssErrorText:"error-text"},configure:function(){requireSpratAppInitialized()||function(){throw"sprat/app.js not included?"}();switch(sprat.$spratAppInstance.flavor()){case"spring":sprat.ui.validation.errorDecorator.configureSpring();break;case"laravel":sprat.ui.validation.errorDecorator.configureLaravel()}},configureLaravel:function(){sprat.ui.validation.errorDecorator.defaultOptions.errors.transform=function(_errors){var r=[];if(null!==_errors&&"object"==typeof _errors)for(var key in _errors)r.push({field:key,message:_errors[key]});return r}},configureSpring:function(){sprat.ui.validation.errorDecorator.defaultOptions.errors.transform=function(_errors){return _errors}}},sprat.ui.validation.errorDecorator.create=function(options){function instance(options){var self=this;if(options=options||{},options instanceof jQuery){var useInstance=options;options={form:{$instance:useInstance}}}self.options=$.extend(!0,$.extend(!0,[],sprat.ui.validation.errorDecorator.defaultOptions),options),self.$form=self.options.form.$instance||$(self.options.form.selector),self.clear=function(){var cssHasError=self.options.cssHasError;self.$form.find("."+cssHasError).removeClass(cssHasError),self.$form.find(".error-text").remove()},self.highlightInputErrors=function(){$("div."+self.options.cssErrorContainer).each(function(){$(this).closest(".form-group").addClass(self.options.cssHasError)})},self.updateException=function(_exception){self.clear(),self.$form.prepend(self.options.exception.formatException(_exception,self))},self.updateErrors=function(errors){return self.clear(),errors?(errors=self.options.errors.transform(errors),self.bindErrors(errors)):0},self.bindErrors=function(errors){var i=0,m=0,error=null,ctx=null,r={unmappedErrors:[],mappedErrors:[],length:errors.length,summary:""};for(i=0,m=errors.length;m>i;i++){error=errors[i];var field=error.field||error.property,message=error.message||error.defaultMessage;if(input=self.options.form.resolveInput(field,self.$form),ctx={field:field,message:message,$input:$(input)},input){r.mappedErrors.push(ctx);var parentDiv=input.closest(".form-group");parentDiv.addClass(self.options.cssHasError),$(input).after(self.options.errors.formatInputError(field,message,self))}else r.unmappedErrors.push(ctx)}if(errors.length>0){r.summary=self.options.errors.formatSummary(errors,r.unmappedErrors,self);var summary="<div class='"+self.options.cssErrorText+" alert alert-danger validation-summary'>"+r.summary+"</div>";self.options.errors.displaySummary(summary,self.$form,self.options)}return r}}return new instance(options)};var sprat=sprat||{};sprat.ui=sprat.ui||{},sprat.ui.component=sprat.ui.component||{},sprat.ui.component.dataTable=function(_defaults){var ComponentDataTable=function(_defaults){var self=this;self.defaults=_defaults||{};var _internal={cssClasses:{isOrderable:"is-orderable",isSearchable:"is-searchable"},attributes:{prefix:"sprat-datatable-",renderer:"renderer",property:"property",alias:"alias"}},util={isOptionPresent:function(jqElem,option){return null!==this.optionValue(jqElem,option)},isCssClassPresent:function(jqElem,clazz){return jqElem.hasClass(_internal.attributes.prefix+clazz)},optionValue:function(jqElem,option){var r=jqElem.attr(_internal.attributes.prefix+option);return void 0===r?null:r}},instance={restEndpoint:null,endpointQueue:[],initialized:!1,lastReceivedData:null,options:{springDataAttribute:null,requestParameters:{},datatable:{order:[0,"desc"],jQueryUI:!1,stateSave:!0,serverSide:!0,ordering:!0,paging:!0,searching:!1,pagingType:"full_numbers",language:{processing:"Verarbeite...",lengthMenu:'<span class="itemsPerPage">Eintr&auml;ge pro Seite:</span> <span style="font-size: 11px;">_MENU_</span>',zeroRecords:"Keine Eintr&auml;ge gefunden",emptyTable:"Keine Eintr&auml;ge vorhanden",loadingRecords:"Lade...",info:"Zeige _START_ bis _END_ von _TOTAL_ Eintr&auml;gen",infoEmpty:"Zeige 0 bis 0 von 0 Eintr&auml;gen",infoFiltered:"(_MAX_ insgesamt)",infoPostFix:"",thousands:".",search:"Suche:",url:"",paginate:{first:"Erste",previous:"Vorherige",next:"N&auml;chste",last:"Letzte"}}}},columnDefinitions:[],mappedColumns:{},dataTable:null},datatableDefaults={ajax:function(data,callback,settings){var draw=data.draw,pageSize=data.length,start=data.start,pageNum=0===start?0:start/pageSize,sorting={dir:null};data.order&&data.order.length>=0&&(sorting=data.order[0]);var sortDir=sorting.dir,sortCol=$(this).find("thead > tr > th").eq(sorting.column).attr(_internal.attributes.prefix+_internal.attributes.property),defaultRequest={size:pageSize,page:pageNum};sortCol&&(defaultRequest.sort=sortCol+","+sortDir);var request=$.extend(!0,defaultRequest,instance.options.requestParameters),endpoint=self.getEndpoint();$rest.get(endpoint,request,function(afterReceive){var r=instance.convertResponseToDatatable(afterReceive,draw);callback(r)})}};return self.lastReceivedData=function(){return instance.lastReceivedData},self.bindTable=function(_table){if(!(_table instanceof jQuery))throw"bindTable argument must be a jQuery table element";return instance.table=_table,_table.data("sprat-datatable",self),self},self.toEndpoint=function(_endpoint){return instance.restEndpoint=_endpoint,self},self.withSpringDataAttribute=function(_attribute){return instance.options.springDataAttribute=_attribute,self},self.withRequestParameters=function(_parameters){return instance.options.requestParameters=_parameters,self},self.mapColumns=function(mappedColumns){return instance.mappedColumns=mappedColumns,self},self.datatableOptions=function(options){return instance.options.datatable=options,self},self.mapColumn=function(columnIdx,mapColumn){return instance.mappedColumns[columnIdx]=mapColumn,self},self.afterCreatedRow=function(callback){return instance.options.datatable.createdRow=callback,self},self.dataTable=function(){if(!instance.initialized)throw"DataTable not initialized. You must call build() before returning the datatable";return instance.table.DataTable()},self.reload=function(){if(!instance.initialized)throw"DataTable not initialized. You must call build() before changing the source";instance.dataTable?self.dataTable().ajax.reload():self.initDataTable()},self.updateEndpoint=function(source){if(!instance.initialized)throw"DataTable not initialized. You must call build() before changing the source";instance.restEndpoint=source,self.reload()},self.enqueueEndpoint=function(source,instantReload){return instance.endpointQueue.push(source),instantReload&&self.reload(),self},self.getEndpoint=function(){return instance.endpointQueue.length>0?instance.endpointQueue.pop():instance.restEndpoint},self.config=function(){return instance},self.initDataTable=function(){if(instance.dataTable)throw"DataTable of this instance is already initialized";return instance.dataTable=instance.table.dataTable(instance.options.datatable),self},self.build=function(){if($.extend(!0,instance.options.datatable,self.defaults,datatableDefaults),!instance.table)throw"Datatable has not been bound by calling bindTable()";if(!instance.restEndpoint)throw"REST endpoint has not been configured by calling toEndpoint()";if(instance.buildColumnDefinitions=function(){if(!instance.initialized){var definitions=[];return instance.table.find("thead > tr > th").each(function(idx,value){var attributeValue=null,spec={targets:idx,orderable:!1,searchable:!1,data:null};if(util.isCssClassPresent($(this),_internal.cssClasses.isOrderable)&&(spec.orderable=!0),util.isCssClassPresent($(this),_internal.cssClasses.isSearchable)&&(spec.searchable=!0),null!==(customRenderer=util.optionValue($(this),_internal.attributes.renderer))){if(!sprat.ui||!sprat.ui.renderer)throw"You are using a customer renderer but sprat.ui has not been included. Add <script src='$SPRAT_PATH/dist/ui/renderer.js'></script> to your HTML file";spec.render=sprat.ui.renderer.get(customRenderer,instance)}null!==(attributeValue=util.optionValue($(this),_internal.attributes.property))&&(spec.name=attributeValue,spec.data=attributeValue);var useAlias=util.optionValue($(this),_internal.attributes.alias)||-1,configuredRenderer=instance.mappedColumns[useAlias]||instance.mappedColumns[idx];configuredRenderer&&(spec.render=configuredRenderer),spec.render||(console.warn("Column idx"+idx+" has no renderer. Using default renderer"),spec.render=function(data,type,full,last){return data}),definitions.push(spec)}),instance.initialized=!0,definitions}},instance.convertResponseToDatatable=function(json,draw){instance.lastReceivedData=json;var recordsTotalSelector=".totalElements",recordsFilteredSelector=".totalElements",dataSelector="array.content",r={recordsTotal:0,recordsFiltered:0,data:[],draw:draw};if(instance.options.springDataAttribute&&(dataSelector="._embedded ."+instance.options.springDataAttribute),instance.options.datatable.selector&&(recordsTotalSelector=instance.options.datatable.selector.recordsTotal||recordsTotalSelector,recordsFilteredSelector=instance.options.datatable.selector.recordsFiltered||recordsFilteredSelector,dataSelector=instance.options.datatable.selector.data=dataSelector),!dataSelector)throw"No dataSelector set";if(!window.JSONSelect)throw"No JSONSelect on path (http://jsonselect.org/)";if(r.recordsFiltered=window.JSONSelect.match(recordsFilteredSelector,json)[0],r.recordsTotal=window.JSONSelect.match(recordsTotalSelector,json)[0],r.recordsTotal>0){var matchedData=window.JSONSelect.match(dataSelector,json);if(r.data=matchedData[0],void 0===r.data)throw"Could not find any data for selector '"+dataSelector+"'. Check your selector for any typos. Maybe you are missing a withSpringDataAttribute() call?"}return r},instance.options.datatable.columnDefs=instance.buildColumnDefinitions(),!instance.table.dataTable)throw"sprat.ui.component.dataTable requires DataTables (https://www.datatables.net/).";var initializeDataTable=!0;return arguments.length>0&&(initializeDataTable=arguments[0]),initializeDataTable&&self.initDataTable(),self},self};return new ComponentDataTable(_defaults)};var sprat=sprat||{};sprat.ui=sprat.ui||{},sprat.ui.component=sprat.ui.component||{},sprat.ui.component.dataTable=sprat.ui.component.dataTable||{},sprat.ui.component.dataTable.scopeable=function(dataTable,_config){var DataTableDecoratorScopeable=function(dataTable,_config){var self=this;if(!dataTable||!dataTable.config)throw"sprat.ui.component.dataTable.scopeable requires sprat.ui.component.dataTable instance as first argument";var defaults={requestdScopeHttpGetParam:"scope",endpoint:{url:void 0,builder:function(scope,dataTable,config){return dataTable.withRequestParameters({scope:scope}),config.endpoint.url}},widget:{selector:"button.sprat-query",enable:function($item){$item.removeClass("btn-default"),$item.addClass("btn-primary")},disable:function($item){$item.removeClass("btn-primary"),$item.addClass("btn-default")}}};self.dataTable=dataTable,self.config=$.extend(!0,{},defaults,_config),self.config.endpoint.url||(self.config.endpoint.url=dataTable.config().restEndpoint);var util={getParam:function(name){var results=new RegExp("[?&]"+name+"=([^&#]*)").exec(window.location.href);return null===results?null:decodeURIComponent(results[1])||null}};self.requestedScope=function(){var scope=util.getParam(self.config.requestdScopeHttpGetParam);return $("button[sprat-query-scope='"+scope+"']").length>0?scope:void 0},self.findScopeWidget=function(scope){for(var items=$(self.config.widget.selector),item=null,queryScope=null,i=0,m=items.length;m>i;i++){if(item=items[i],queryScope=$(item).attr("sprat-query-scope"),!scope&&!queryScope)return item;if(scope==queryScope)return item}return null},self.findCurrentWidget=function(){return self.findScopeWidget(self.currentScope)},self.enableScope=function(scope){var widget=self.findScopeWidget(scope);if(!widget)throw"Trying to activate non-existing scope '"+scope+"'";self.currentScope=scope,$(self.config.widget.selector).each(function(){$(this).is($(widget))?self.config.widget.enable($(this)):self.config.widget.disable($(this))}),$(this).trigger("scope-activated",[self.currentScope]),self.dataTable.config().table.trigger("scope-activated",[self.currentScope]),self.dataTable.updateEndpoint(self.config.endpoint.builder(self.currentScope,self.dataTable,self.config))},self.init=function(){return $(self.config.widget.selector).click(function(){self.enableScope($(this).attr("sprat-query-scope"))}),self.enableScope(self.requestedScope()),self.dataTable.config().table.data("sprat-datatable-scopeable",self),self}};return new DataTableDecoratorScopeable(dataTable,_config)};var sprat=sprat||{};sprat.ui=sprat.ui||{},sprat.ui.component=sprat.ui.component||{},sprat.ui.component.dataTable=sprat.ui.component.dataTable||{},sprat.ui.component.dataTable.searchable=function(dataTable,_config){var DataTableDecoratorSearchable=function(dataTable,_config){var self=this;if(!dataTable||!dataTable.config)throw"sprat.ui.component.dataTable.searchable requires sprat.ui.component.dataTable instance as first argument";var defaults={endpoint:{url:null},formAsQuery:function(){return null},widget:{selector:".sprat-search",scoping:null,close:function(){$(".box-search [data-widget='collapse']").click()}}};self.dataTable=dataTable,self.config=$.extend(!0,{},defaults,_config),self.config.endpoint.url||(self.config.endpoint.url=dataTable.config().restEndpoint),self.formAsQuery=function(formAsQuery){return self.config.formAsQuery=formAsQuery,self},self.withEndpoint=function(url){return url.startsWith("/")?self.config.endpoint.url=url:self.config.endpoint.url+="/"+url,self},self.init=function(){$(self.dataTable.config().table).on("scope-activated",function(){self.config.widget.close()}),$(self.config.widget.selector).click(function(){var requestParameters=self.config.formAsQuery();if(!requestParameters)return!1;var scopeable=self.dataTable.config().table.data("sprat-datatable-scopeable");scopeable&&scopeable.config.widget.disable($(scopeable.findCurrentWidget())),self.dataTable.withRequestParameters(requestParameters),self.dataTable.enqueueEndpoint(self.config.endpoint.url,!0)})}};return new DataTableDecoratorSearchable(dataTable,_config)};